to-do deployment


PROJECT_ID="fluted-factor-438905-d2"
SERVICE_ACCOUNT="todo-deployer@$PROJECT_ID.iam.gserviceaccount.com"

gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SERVICE_ACCOUNT" --role="roles/container.admin"

gcloud iam service-accounts keys create key.json --iam-account=todo-deployer@fluted-factor-438905-d2.iam.gserviceaccount.com --project=fluted-factor-438905-d2

gcloud artifacts repositories create todo-repo --repository-format=docker --location=asia-south1 --description="ToDo App Docker Images"

gcloud container clusters create todo-cluster --zone asia-south1-a --num-nodes 3 --project fluted-factor-438905-d2

gcloud container clusters get-credentials todo-cluster --zone asia-south1-a --project fluted-factor-438905-d2


kubectl create secret generic mysql-secret --from-literal=mysql-root-password=root


gcloud projects add-iam-policy-binding fluted-factor-438905-d2 --member="serviceAccount:todo-deployer@fluted-factor-438905-d2.iam.gserviceaccount.com" --role="roles/artifactregistry.writer"

kubectl rollout restart deployment backend

curl -X POST http://34.100.187.174:5000/tasks -H "Content-Type: application/json" -d '{"title": "Test Task"}'


creating table

kubectl exec -it statefulset/mysql -- mysql -u root -p todo_db

pass: myStrongPassword123

SHOW DATABASES;
USE todo;
SHOW TABLES;

CREATE DATABASE IF NOT EXISTS todo_db;
USE todo_db;

CREATE TABLE IF NOT EXISTS tasks (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL
);


SHOW TABLES;
SELECT * FROM todo_db;

exit;

verify

# Check pods
kubectl get pods

# Check MySQL tables
kubectl exec -it statefulset/mysql -- mysql -u root -p -e "USE todo_db; SHOW TABLES;"

# Test backend directly
curl http://34.14.161.147:5000/tasks

firewall rule
gcloud compute firewall-rules create allow-backend-5000 --allow tcp:5000 --target-tags=gke-todo-cluster --description="Allow external access to backend on port 5000" --direction=INGRESS --source-ranges=0.0.0.0/0 --project=fluted-factor-438905-d2